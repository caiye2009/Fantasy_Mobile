"use strict";const p=require("./props.js"),c=require("../../libs/mixin/mpMixin.js"),f=require("../../libs/mixin/mixin.js"),u=require("../../libs/function/index.js"),d=require("../../libs/function/test.js"),s=require("../../../../common/vendor.js"),I={name:"u-picker",mixins:[c.mpMixin,f.mixin,p.props],data(){return{lastIndex:[],innerIndex:[],innerColumns:[],columnIndex:0,showByClickInput:!1,currentActiveValue:[]}},watch:{columns:{immediate:!0,deep:!0,handler(e){this.setColumns(e)}},defaultIndex:{immediate:!0,deep:!0,handler(e,t){(!t||e.join("/")!=t.join("/"))&&this.setIndexs(e,!0)}},modelValue:{immediate:!0,deep:!0,handler(e,t){if(!t||e.join("/")!=t.join("/")){let i=[];e!=null&&(e.forEach((r,o)=>{let n=this.getColumnValues(o);!Array.isArray(n)&&n.length===0||(typeof n[0]=="object"?n.forEach((l,a)=>{l[this.valueName]==r&&i.push(a)}):n.forEach((l,a)=>{l==r&&i.push(a)}))}),i.length==0&&this.defaultIndex||this.setIndexs(i,!0))}}}},emits:["close","cancel","confirm","change","update:modelValue","update:show"],computed:{inputPropsInner(){return{border:this.inputBorder,placeholder:this.placeholder,disabled:this.disabled,disabledColor:this.disabledColor,...this.inputProps}},inputLabel(){let e=this.innerColumns[0]&&this.innerColumns[0][0];if(e&&Object.prototype.toString.call(e)==="[object Object]"){let t=this.innerColumns[0].filter(i=>this.modelValue.includes(i.id));return t=t.map(i=>i[this.keyName]),t.join("/")}else return this.modelValue.join("/")},inputValue(){let e=this.innerColumns.map((i,r)=>i[this.innerIndex[r]]),t=[];return e[0]&&Object.prototype.toString.call(e[0])==="[object Object]"?e.forEach(i=>{t.push(i&&i[this.valueName])}):e.forEach((i,r)=>{t.push(i)}),t}},methods:{addUnit:u.addUnit,testArray:d.test.array,onShowByClickInput(){this.disabled||(this.showByClickInput=!this.showByClickInput)},getItemText(e){return d.test.object(e)?e[this.keyName]:e},closeHandler(){this.closeOnClickOverlay&&(this.hasInput&&(this.showByClickInput=!1),this.setDefault(),this.$emit("update:show",!1),this.$emit("close"))},cancel(){this.hasInput&&(this.showByClickInput=!1),this.setDefault(),this.$emit("update:show",!1),this.$emit("cancel")},setDefault(){let e=[0];this.lastIndex.length==0?Array.isArray(this.defaultIndex)&&this.defaultIndex.length==this.innerColumns.length?e=[...this.defaultIndex]:e=Array(this.innerColumns.length).fill(0):e=u.deepClone(this.lastIndex),this.setLastIndex(e),this.setIndexs(e)},confirm(){this.currentActiveValue.length||this.setDefault(),this.$emit("update:modelValue",this.inputValue),this.hasInput&&(this.showByClickInput=!1),this.setLastIndex(this.innerIndex),this.$emit("update:show",!1),this.$emit("confirm",{indexs:this.innerIndex,value:this.innerColumns.map((e,t)=>e[this.innerIndex[t]]),values:this.innerColumns})},changeHandler(e){const{value:t}=e.detail;let i=0,r=0;this.currentActiveValue=t;for(let n=0;n<t.length;n++){let l=t[n];if(l!==void 0&&l!==(this.lastIndex[n]||0)){r=n,i=l;break}}this.columnIndex=r;const o=this.innerColumns;this.setIndexs(t),this.$emit("change",{value:this.innerColumns.map((n,l)=>n[t[l]]),index:i,indexs:t,values:o,columnIndex:r})},setIndexs(e,t){this.innerIndex=u.deepClone(e),t&&this.setLastIndex(e)},setLastIndex(e){this.lastIndex=u.deepClone(e)},setColumnValues(e,t){this.innerColumns.splice(e,1,t),this.setLastIndex(this.innerIndex.slice(0,e));let i=u.deepClone(this.innerIndex);for(let r=0;r<this.innerColumns.length;r++)r>this.columnIndex&&(i[r]=0);this.setIndexs(i)},getColumnValues(e){return(async()=>await u.sleep())(),this.innerColumns[e]},setColumns(e){this.innerColumns=u.deepClone(e),this.innerIndex.length===0&&(this.innerIndex=new Array(e.length).fill(0))},getIndexs(){return this.innerIndex},getValues(){return(async()=>await u.sleep())(),this.innerColumns.map((e,t)=>e[this.innerIndex[t]])}}};if(!Array){const e=s.resolveComponent("u-input"),t=s.resolveComponent("u-toolbar"),i=s.resolveComponent("u-loading-icon"),r=s.resolveComponent("u-popup");(e+t+i+r)()}const C=()=>"../u-input/u-input.js",g=()=>"../u-toolbar/u-toolbar.js",y=()=>"../u-loading-icon/u-loading-icon.js",b=()=>"../u-popup/u-popup.js";Math||(C+g+y+b)();function _(e,t,i,r,o,n){return s.e({a:e.hasInput},e.hasInput?s.e({b:s.r("d",{value:n.inputLabel}),c:s.r("trigger",{value:n.inputLabel}),d:!e.$slots.default&&!e.$slots.$default&&!e.$slots.trigger},!e.$slots.default&&!e.$slots.$default&&!e.$slots.trigger?{e:s.o(l=>n.inputLabel=l),f:s.p({readonly:!0,...n.inputPropsInner,modelValue:n.inputLabel})}:{},{g:s.o((...l)=>n.onShowByClickInput&&n.onShowByClickInput(...l))}):{},{h:e.showToolbar},e.showToolbar?{i:s.o(n.cancel),j:s.o(n.confirm),k:s.p({cancelColor:e.cancelColor,confirmColor:e.confirmColor,cancelText:e.cancelText,confirmText:e.confirmText,title:e.title,rightSlot:!!e.toolbarRightSlot})}:{},{l:s.f(o.innerColumns,(l,a,v)=>s.e({a:n.testArray(l)},n.testArray(l)?{b:s.f(l,(m,h,x)=>({a:s.t(n.getItemText(m)),b:s.n(h===o.innerIndex[a]&&"u-picker__view__column__item--selected"),c:h,d:h===o.innerIndex[a]?"bold":"normal"})),c:n.addUnit(e.itemHeight,"px"),d:n.addUnit(e.itemHeight,"px")}:{},{e:a})),m:e.maskClass,n:e.maskStyle,o:`height: ${n.addUnit(e.itemHeight,"px")}`,p:o.innerIndex,q:e.immediateChange,r:`${n.addUnit(e.visibleItemCount*e.itemHeight,"px")}`,s:s.o((...l)=>n.changeHandler&&n.changeHandler(...l)),t:e.loading},e.loading?{v:s.p({mode:"circle"})}:{},{w:s.o(n.closeHandler),x:s.p({show:e.show||e.hasInput&&o.showByClickInput,mode:e.popupMode,zIndex:e.zIndex,bgColor:e.bgColor,round:e.round,duration:e.duration,pageInline:e.pageInline,overlayOpacity:e.overlayOpacity})})}const w=s._export_sfc(I,[["render",_],["__scopeId","data-v-91b05052"]]);wx.createComponent(w);
