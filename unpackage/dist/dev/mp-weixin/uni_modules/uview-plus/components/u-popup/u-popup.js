"use strict";const h=require("./props.js"),l=require("../../libs/mixin/mpMixin.js"),c=require("../../libs/mixin/mixin.js"),i=require("../../libs/function/index.js"),t=require("../../../../common/vendor.js"),m={name:"u-popup",mixins:[l.mpMixin,c.mixin,h.props],data(){return{overlayDuration:this.duration+50,touchStartY:0,touchStartHeight:0,isTouching:!1,currentHeight:"auto"}},watch:{show(e,u){if(e===!0){const s=this.$children;this.retryComputedComponentRect(s)}}},computed:{transitionStyle(){const e={display:"flex"};if(this.pageInline||(e.zIndex=this.zIndex,e.position="fixed"),e[this.mode]=0,this.mode==="left")return i.deepMerge(e,{bottom:0,top:0});if(this.mode==="right")return i.deepMerge(e,{bottom:0,top:0});if(this.mode==="top")return i.deepMerge(e,{left:0,right:0});if(this.mode==="bottom")return i.deepMerge(e,{left:0,right:0});if(this.mode==="center")return i.deepMerge(e,{alignItems:"center","justify-content":"center",top:0,left:0,right:0,bottom:0})},contentStyleWrap(){const e={};return this.mode==="bottom"&&this.touchable&&(this.currentHeight!=="auto"&&(e.height=this.currentHeight),this.maxHeight&&(e.maxHeight=i.addUnit(this.maxHeight)),this.minHeight&&(e.minHeight=i.addUnit(this.minHeight))),e},contentStyle(){const e={};if(i.getWindowInfo(),this.mode!=="center"&&(e.flex=1),this.bgColor&&(e.backgroundColor=this.bgColor),this.round){const u=i.addUnit(this.round);this.mode==="top"?(e.borderBottomLeftRadius=u,e.borderBottomRightRadius=u):this.mode==="bottom"?(e.borderTopLeftRadius=u,e.borderTopRightRadius=u):this.mode==="center"&&(e.borderRadius=u)}return i.deepMerge(e,i.addStyle(this.customStyle))},position(){if(this.mode==="center")return this.zoom?"fade-zoom":"fade";if(this.mode==="left")return"slide-left";if(this.mode==="right")return"slide-right";if(this.mode==="bottom")return"slide-up";if(this.mode==="top")return"slide-down"}},emits:["open","close","click","update:show"],methods:{overlayClick(){this.closeOnClickOverlay&&(this.$emit("update:show",!1),this.$emit("close"))},open(e){this.$emit("update:show",!0)},close(e){this.$emit("update:show",!1),this.$emit("close")},afterEnter(){this.$emit("open")},clickHandler(){this.mode==="center"&&this.overlayClick(),this.$emit("click")},retryComputedComponentRect(e){const u=["u-calendar-month","u-album","u-collapse-item","u-dropdown","u-index-item","u-index-list","u-line-progress","u-list-item","u-rate","u-read-more","u-row","u-row-notice","u-scroll-list","u-skeleton","u-slider","u-steps-item","u-sticky","u-subsection","u-swipe-action-item","u-tabbar","u-tabs","u-tooltip"];for(let s=0;s<e.length;s++){const n=e[s],a=n.$children;u.includes(n.$options.name)&&typeof(n==null?void 0:n.init)=="function"&&i.sleep(50).then(()=>{n.init()}),a.length&&this.retryComputedComponentRect(a)}},onTouchStart(e){!this.touchable||this.mode!=="bottom"||(this.isTouching=!0,this.touchStartY=e.touches[0].clientY,this.touchStartHeight=this.$el.querySelector(".u-popup__contentâ€”transition").offsetHeight)},onTouchMove(e){if(!this.isTouching||!this.touchable||this.mode!=="bottom")return;const s=e.touches[0].clientY-this.touchStartY;if(s!==0){const n=this.touchStartHeight-s,a=parseFloat(i.addUnit(this.minHeight))||200,o=this.maxHeight?this.maxHeight.toString().includes("%")?i.getWindowInfo().windowHeight*(parseFloat(this.maxHeight)/100):parseFloat(i.addUnit(this.maxHeight)):i.getWindowInfo().windowHeight*.8;n>=a&&n<=o&&(this.currentHeight=n+"px")}e.preventDefault()},onTouchEnd(e){if(!this.isTouching||!this.touchable||this.mode!=="bottom")return;this.isTouching=!1;const s=e.changedTouches[0].clientY-this.touchStartY,n=Math.abs(s)/(e.timeStamp-e.changedTouches[0].timestamp);(s>100||s>30&&n>.5)&&this.close()}}};if(!Array){const e=t.resolveComponent("u-overlay"),u=t.resolveComponent("u-status-bar"),s=t.resolveComponent("u-icon"),n=t.resolveComponent("u-safe-bottom"),a=t.resolveComponent("u-transition");(e+u+s+n+a)()}const d=()=>"../u-overlay/u-overlay.js",p=()=>"../u-status-bar/u-status-bar.js",f=()=>"../u-icon/u-icon.js",g=()=>"../u-safe-bottom/u-safe-bottom.js",y=()=>"../u-transition/u-transition.js";Math||(d+p+f+g+y)();function b(e,u,s,n,a,o){return t.e({a:t.o((...r)=>o.open&&o.open(...r)),b:e.overlay},e.overlay?{c:t.o(o.overlayClick),d:t.p({show:e.show&&e.pageInline==!1,zIndex:e.zIndex,duration:a.overlayDuration,customStyle:e.overlayStyle,opacity:e.overlayOpacity})}:{},{e:e.safeAreaInsetTop},e.safeAreaInsetTop?{}:{},{f:e.touchable&&e.mode==="bottom"},e.touchable&&e.mode==="bottom"?{g:t.o((...r)=>o.onTouchStart&&o.onTouchStart(...r)),h:t.o((...r)=>o.onTouchMove&&o.onTouchMove(...r)),i:t.o((...r)=>o.onTouchEnd&&o.onTouchEnd(...r)),j:t.o((...r)=>o.onTouchEnd&&o.onTouchEnd(...r))}:{},{k:e.closeable},e.closeable?{l:t.p({name:"close",color:"#909399",size:"18",bold:!0}),m:t.o((...r)=>o.close&&o.close(...r)),n:t.n("u-popup__content__close--"+e.closeIconPos)}:{},{o:e.safeAreaInsetBottom},e.safeAreaInsetBottom?{}:{},{p:t.s(o.contentStyle),q:t.o((...r)=>e.noop&&e.noop(...r)),r:t.o((...r)=>e.noop&&e.noop(...r)),s:t.s(o.contentStyleWrap),t:t.o(o.afterEnter),v:t.o(o.clickHandler),w:t.p({show:e.pageInline?!0:e.show,customStyle:o.transitionStyle,mode:e.pageInline?"none":o.position,duration:e.duration}),x:t.n(e.customClass),y:e.show==!1?"0px":"",z:e.show==!1?"0px":""})}const _=t._export_sfc(m,[["render",b],["__scopeId","data-v-05c24e9b"]]);wx.createComponent(_);
