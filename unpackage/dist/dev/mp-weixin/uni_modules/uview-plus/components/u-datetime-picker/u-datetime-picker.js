"use strict";const d=require("./props.js"),f=require("../../libs/mixin/mpMixin.js"),y=require("../../libs/mixin/mixin.js"),r=require("./dayjs.esm.min.js"),u=require("../../libs/function/index.js"),m=require("../../../../common/vendor.js");function g(e,i){let t=-1;const n=Array(e<0?0:e);for(;++t<e;)n[t]=i(t);return n}const I={name:"up-datetime-picker",mixins:[f.mpMixin,y.mixin,d.props],data(){return{inputValue:"",showByClickInput:!1,columns:[],innerDefaultIndex:[],innerFormatter:(e,i)=>i}},watch:{show(e,i){e&&(this.innerValue=this.correctValue(this.modelValue),this.updateColumnValue(this.innerValue))},modelValue(e){this.init()},propsChange(){this.init()}},computed:{propsChange(){return[this.mode,this.maxDate,this.minDate,this.minHour,this.maxHour,this.minMinute,this.maxMinute,this.filter,this.modelValue]},inputPropsInner(){return{border:this.inputBorder,placeholder:this.placeholder,disabled:this.disabled,disabledColor:this.disabledColor,...this.inputProps}}},mounted(){this.init()},emits:["close","cancel","confirm","change","update:modelValue"],methods:{getInputValue(e){if(e==""||!e||e==null){this.inputValue="";return}if(this.mode=="time")this.inputValue=e;else if(this.format)this.inputValue=r.e(e).format(this.format);else{let i="";switch(this.mode){case"date":i="YYYY-MM-DD";break;case"year-month":i="YYYY-MM";break;case"datehour":i="YYYY-MM-DD HH";break;case"datetime":i="YYYY-MM-DD HH:mm";break;case"time":i="HH:mm";break}this.inputValue=r.e(e).format(i)}},init(){this.innerValue=this.correctValue(this.modelValue),this.updateColumnValue(this.innerValue),this.getInputValue(this.innerValue)},setFormatter(e){this.innerFormatter=e},close(){this.closeOnClickOverlay&&this.$emit("close")},cancel(){this.hasInput&&(this.showByClickInput=!1),this.$emit("cancel")},confirm(){this.$emit("update:modelValue",this.innerValue),this.hasInput&&(this.getInputValue(this.innerValue),this.showByClickInput=!1),this.$emit("confirm",{value:this.innerValue,mode:this.mode})},intercept(e,i){let t=e.match(/\d+/g);return t.length>1?(u.error("请勿在过滤或格式化函数时添加数字"),0):i&&t[0].length==4?t[0]:t[0].length>2?(u.error("请勿在过滤或格式化函数时添加数字"),0):t[0]},change(e){const{indexs:i,values:t}=e;let n="";if(this.mode==="time")n=`${this.intercept(t[0][i[0]])}:${this.intercept(t[1][i[1]])}`;else{const o=parseInt(this.intercept(t[0][i[0]],"year")),s=parseInt(this.intercept(t[1][i[1]]));let a=parseInt(t[2]?this.intercept(t[2][i[2]]):1),h=0,l=0;const c=r.e(`${o}-${s}`).daysInMonth();this.mode==="year-month"&&(a=1),a=Math.min(c,a),this.mode==="datetime"&&(h=parseInt(this.intercept(t[3][i[3]])),l=parseInt(this.intercept(t[4][i[4]]))),n=Number(new Date(o,s-1,a,h,l))}n=this.correctValue(n),this.innerValue=n,this.updateColumnValue(n),this.$emit("change",{value:n,mode:this.mode})},updateColumnValue(e){this.innerValue=e,this.updateColumns(),setTimeout(()=>{this.updateIndexs(e)},0)},updateIndexs(e){let i=[];const t=this.formatter||this.innerFormatter;if(this.mode==="time"){const o=e.split(":");i=[t("hour",o[0]),t("minute",o[1])]}else i=[t("year",`${r.e(e).year()}`),t("month",u.padZero(r.e(e).month()+1))],this.mode==="date"&&i.push(t("day",u.padZero(r.e(e).date()))),this.mode==="datetime"&&i.push(t("day",u.padZero(r.e(e).date())),t("hour",u.padZero(r.e(e).hour())),t("minute",u.padZero(r.e(e).minute())));const n=this.columns.map((o,s)=>Math.max(0,o.findIndex(a=>a===i[s])));this.innerDefaultIndex=n},updateColumns(){const e=this.formatter||this.innerFormatter,i=this.getOriginColumns().map(t=>t.values.map(n=>e(t.type,n)));this.columns=i},getOriginColumns(){return this.getRanges().map(({type:i,range:t})=>{let n=g(t[1]-t[0]+1,o=>{let s=t[0]+o;return s=i==="year"?`${s}`:u.padZero(s),s});return this.filter&&(n=this.filter(i,n),(!n||n&&n.length==0)&&console.log("日期filter结果不能为空")),{type:i,values:n}})},generateArray(e,i){return Array.from(new Array(i+1).keys()).slice(e)},correctValue(e){const i=this.mode!=="time";if(i&&!r.e.unix(e).isValid()?e=this.minDate:!i&&!e&&(e=`${u.padZero(this.minHour)}:${u.padZero(this.minMinute)}`),i)return e=r.e(e).isBefore(r.e(this.minDate))?this.minDate:e,e=r.e(e).isAfter(r.e(this.maxDate))?this.maxDate:e,e;{if(String(e).indexOf(":")===-1)return u.error("时间错误，请传递如12:24的格式");let[t,n]=e.split(":");return t=u.padZero(u.range(this.minHour,this.maxHour,Number(t))),n=u.padZero(u.range(this.minMinute,this.maxMinute,Number(n))),`${t}:${n}`}},getRanges(){if(this.mode==="time")return[{type:"hour",range:[this.minHour,this.maxHour]},{type:"minute",range:[this.minMinute,this.maxMinute]}];const{maxYear:e,maxDate:i,maxMonth:t,maxHour:n,maxMinute:o}=this.getBoundary("max",this.innerValue),{minYear:s,minDate:a,minMonth:h,minHour:l,minMinute:c}=this.getBoundary("min",this.innerValue),p=[{type:"year",range:[s,e]},{type:"month",range:[h,t]},{type:"day",range:[a,i]},{type:"hour",range:[l,n]},{type:"minute",range:[c,o]}];return this.mode==="date"&&p.splice(3,2),this.mode==="year-month"&&p.splice(2,3),p},getBoundary(e,i){let t=new Date(i);isNaN(t.getTime())&&(t=new Date);const n=new Date(this[`${e}Date`]),o=r.e(n).year();let s=1,a=1,h=0,l=0;return e==="max"&&(s=12,a=r.e(t).daysInMonth(),h=23,l=59),r.e(t).year()===o&&(s=r.e(n).month()+1,r.e(t).month()+1===s&&(a=r.e(n).date(),r.e(t).date()===a&&(h=r.e(n).hour(),r.e(t).hour()===h&&(l=r.e(n).minute())))),{[`${e}Year`]:o,[`${e}Month`]:s,[`${e}Date`]:a,[`${e}Hour`]:h,[`${e}Minute`]:l}},onShowByClickInput(){this.disabled||(this.showByClickInput=!this.showByClickInput)}}};if(!Array){const e=m.resolveComponent("u-input"),i=m.resolveComponent("u-picker");(e+i)()}const C=()=>"../u-input/u-input.js",V=()=>"../u-picker/u-picker.js";Math||(C+V)();function k(e,i,t,n,o,s){return m.e({a:e.hasInput},e.hasInput?{b:m.o(a=>o.inputValue=a),c:m.p({readonly:!!o.showByClickInput,...s.inputPropsInner,modelValue:o.inputValue}),d:m.r("trigger",{value:o.inputValue}),e:m.o((...a)=>s.onShowByClickInput&&s.onShowByClickInput(...a))}:{},{f:m.sr("picker","e7a0f1eb-1"),g:m.o(s.close),h:m.o(s.cancel),i:m.o(s.confirm),j:m.o(s.change),k:m.p({show:e.pageInline||e.show||e.hasInput&&o.showByClickInput,popupMode:e.popupMode,closeOnClickOverlay:e.closeOnClickOverlay,columns:o.columns,title:e.title,itemHeight:e.itemHeight,showToolbar:e.showToolbar,visibleItemCount:e.visibleItemCount,defaultIndex:o.innerDefaultIndex,cancelText:e.cancelText,confirmText:e.confirmText,cancelColor:e.cancelColor,confirmColor:e.confirmColor,toolbarRightSlot:e.toolbarRightSlot,pageInline:e.pageInline,maskClass:e.maskClass,maskStyle:e.maskStyle})})}const M=m._export_sfc(I,[["render",k],["__scopeId","data-v-e7a0f1eb"]]);wx.createComponent(M);
