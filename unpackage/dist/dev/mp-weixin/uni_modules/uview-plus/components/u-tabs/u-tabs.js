"use strict";const r=require("../../../../common/vendor.js"),c=require("./props.js"),f=require("../../libs/mixin/mpMixin.js"),g=require("../../libs/mixin/mixin.js"),b=require("../../libs/config/props.js"),u=require("../../libs/function/index.js"),_={name:"u-tabs",mixins:[f.mpMixin,g.mixin,c.props],data(){return{firstTime:!0,scrollLeft:0,scrollViewWidth:0,lineOffsetLeft:0,tabsRect:{left:0},innerCurrent:0,moving:!1}},watch:{current:{immediate:!0,handler(e,s){e!==this.innerCurrent&&(typeof e=="string"?this.innerCurrent=parseInt(e):this.innerCurrent=e,this.$nextTick(()=>{this.resize()}))}},list(){this.$nextTick(()=>{this.resize()})}},computed:{textStyle(){return e=>{const s={},n=e==this.innerCurrent?u.addStyle(this.activeStyle):u.addStyle(this.inactiveStyle);return this.list[e].disabled&&(s.color="#c8c9cc"),u.deepMerge(n,s)}},propsBadge(){return b.props.badge}},async mounted(){this.init(),this.windowResizeCallback=e=>{this.init()},r.index.onWindowResize(this.windowResizeCallback)},beforeUnmount(){r.index.offWindowResize(this.windowResizeCallback)},emits:["click","longPress","change","update:current"],methods:{addStyle:u.addStyle,addUnit:u.addUnit,setLineLeft(){const e=this.list[this.innerCurrent];if(!e)return;let s=this.list.slice(0,this.innerCurrent).reduce((l,o)=>l+o.rect.width,0);const n=u.getPx(this.lineWidth);this.lineOffsetLeft=s+(e.rect.width-n)/2,this.firstTime&&setTimeout(()=>{this.firstTime=!1},10)},animation(e,s=0){},clickHandler(e,s){this.$emit("click",{...e,index:s},s),!e.disabled&&this.innerCurrent!=s&&(this.innerCurrent=s,this.$nextTick(()=>{this.resize()}),this.$emit("update:current",s),this.$emit("change",{...e,index:s},s))},longPressHandler(e,s){this.$emit("longPress",{...e,index:s})},init(){u.sleep().then(()=>{this.resize()})},setScrollLeft(){this.innerCurrent<0&&(this.innerCurrent=0);const e=this.list[this.innerCurrent],s=this.list.slice(0,this.innerCurrent).reduce((o,i)=>o+i.rect.width,0),n=u.getWindowInfo().windowWidth;let l=s-(this.tabsRect.width-e.rect.width)/2-(n-this.tabsRect.right)/2+this.tabsRect.left/2;l=Math.min(l,this.scrollViewWidth-this.tabsRect.width),this.scrollLeft=Math.max(0,l)},resize(){this.list.length!==0&&Promise.all([this.getTabsRect(),this.getAllItemRect()]).then(([e,s=[]])=>{e.left>e.width&&(e.right=e.right-Math.floor(e.left/e.width)*e.width,e.left=e.left%e.width),this.tabsRect=e,this.scrollViewWidth=0,s.map((n,l)=>{this.scrollViewWidth+=n.width,this.list[l].rect=n}),this.setLineLeft(),this.setScrollLeft()})},getTabsRect(){return new Promise(e=>{this.queryRect("u-tabs__wrapper__scroll-view").then(s=>e(s))})},getAllItemRect(){return new Promise(e=>{const s=this.list.map((n,l)=>this.queryRect(`u-tabs__wrapper__nav__item-${l}`,!0));Promise.all(s).then(n=>e(n))})},queryRect(e,s){return new Promise(n=>{this.$uGetRect(`.${e}`).then(l=>{n(l)})})}}};if(!Array){const e=r.resolveComponent("u-icon"),s=r.resolveComponent("u-badge");(e+s)()}const p=()=>"../u-icon/u-icon.js",m=()=>"../u-badge/u-badge.js";Math||(p+m)();function w(e,s,n,l,o,i){return{a:r.f(e.list,(t,a,d)=>r.e(e.$slots.icon?{a:"icon-"+d,b:r.r("icon",{item:t,keyName:e.keyName,index:a},d)}:r.e({c:t.icon},t.icon?{d:"02b0c54f-0-"+d,e:r.p({name:t.icon,customStyle:i.addStyle(e.iconStyle)})}:{}),e.$slots.content?{f:"content-"+d,g:r.r("content",{item:t,keyName:e.keyName,index:a},d)}:!e.$slots.content&&(e.$slots.default||e.$slots.$default)?{h:"d-"+d,i:r.r("d",{item:t,keyName:e.keyName,index:a},d)}:{j:r.t(t[e.keyName]),k:r.n(t.disabled&&"u-tabs__wrapper__nav__item__text--disabled"),l:r.s(i.textStyle(a))},{m:"02b0c54f-1-"+d,n:r.p({show:!!(t.badge&&(t.badge.show||t.badge.isDot||t.badge.value)),isDot:t.badge&&t.badge.isDot||i.propsBadge.isDot,value:t.badge&&t.badge.value||i.propsBadge.value,max:t.badge&&t.badge.max||i.propsBadge.max,type:t.badge&&t.badge.type||i.propsBadge.type,showZero:t.badge&&t.badge.showZero||i.propsBadge.showZero,bgColor:t.badge&&t.badge.bgColor||i.propsBadge.bgColor,color:t.badge&&t.badge.color||i.propsBadge.color,shape:t.badge&&t.badge.shape||i.propsBadge.shape,numberType:t.badge&&t.badge.numberType||i.propsBadge.numberType,inverted:t.badge&&t.badge.inverted||i.propsBadge.inverted,customStyle:"margin-left: 4px;"}),o:a,p:r.o(h=>i.clickHandler(t,a),a),q:r.o(h=>i.longPressHandler(t,a),a),r:`u-tabs__wrapper__nav__item-${a}`,s:r.n(`u-tabs__wrapper__nav__item-${a}`),t:r.n(t.disabled&&"u-tabs__wrapper__nav__item--disabled"),v:r.n(o.innerCurrent==a?"u-tabs__wrapper__nav__item-active":"")})),b:e.$slots.icon,c:e.$slots.content,d:!e.$slots.content&&(e.$slots.default||e.$slots.$default),e:r.s(i.addStyle(e.itemStyle)),f:r.s({flex:e.scrollable?"":1}),g:r.s({width:i.addUnit(e.lineWidth),transform:`translate(${o.lineOffsetLeft}px)`,transitionDuration:`${o.firstTime?0:e.duration}ms`,height:i.addUnit(e.lineHeight),background:e.lineColor,backgroundSize:e.lineBgSize}),h:e.scrollable,i:o.scrollLeft,j:r.n(e.customClass)}}const y=r._export_sfc(_,[["render",w],["__scopeId","data-v-02b0c54f"]]);wx.createComponent(y);
